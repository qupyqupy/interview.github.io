var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{h(i.next(t))}catch(e){o(e)}}function a(t){try{h(i["throw"](t))}catch(e){o(e)}}function h(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,o&&(s=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,o=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){h.label=n[1];break}if(6===n[0]&&h.label<s[1]){h.label=s[1],s=n;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(n);break}s[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(i){n=[6,i],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},base;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.setListener=function(){},e}(egret.Sprite);t.ViewManager=e,__reflect(e.prototype,"base.ViewManager")}(base||(base={}));var view;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bg=new egret.Shape,e}return __extends(e,t),e.prototype.init=function(){this.bg.graphics.beginFill(362159),this.bg.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),this.bg.graphics.endFill(),this.addChild(this.bg)},e}(base.ViewManager);t.BackgroundManager=e,__reflect(e.prototype,"view.BackgroundManager")}(view||(view={}));var GameEvent;!function(t){var e=function(e){function n(){return e.call(this)||this}return __extends(n,e),n.getInstance=function(){return void 0===this.instance&&(this.instance=new t.EventDispatcher),this.instance},n}(egret.EventDispatcher);t.EventDispatcher=e,__reflect(e.prototype,"GameEvent.EventDispatcher")}(GameEvent||(GameEvent={}));var protocol;!function(t){var e=function(){function t(){this.ws=new egret.WebSocket,this.setListener()}return t.prototype.connect=function(t,e){this.ws.connect(t,e)},t.prototype.setListener=function(){this.ws.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onData,this),this.ws.addEventListener(egret.Event.CONNECT,this.onConnect,this)},t.prototype.onData=function(t){var e=this.ws.readUTF();console.log(e)},t.prototype.onConnect=function(){var t="Hello1111 Egret WebSocket";this.ws.writeUTF(t)},t}();t.GameSocket=e,__reflect(e.prototype,"protocol.GameSocket")}(protocol||(protocol={}));var protocol;!function(t){var e=function(){function t(){}return t.prototype.setListener=function(){},t}();t.Parser=e,__reflect(e.prototype,"protocol.Parser")}(protocol||(protocol={}));var res;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ON_COMPLETE="oncomplete",e}(egret.Event);t.Event=e,__reflect(e.prototype,"res.Event");var n=function(){function e(){this.eventDispatcher=new egret.EventDispatcher,this.loadConfig()}return e.prototype.loadConfig=function(){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onComplete,this),RES.addEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onError,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onComplete=function(e){switch(e.type){case RES.ResourceEvent.CONFIG_COMPLETE:RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onError,this),RES.loadGroup("play");break;case RES.ResourceEvent.GROUP_COMPLETE:var n=new t.Event(t.Event.ON_COMPLETE);t.dbFactory.init(),t.mcFactory.init(),this.eventDispatcher.dispatchEvent(n)}},e.prototype.onProgress=function(t){},e.prototype.onError=function(t){},e.prototype.addEventListener=function(t,e,n){this.eventDispatcher.addEventListener(t,e,n)},e}();t.assets=n,__reflect(n.prototype,"res.assets");var i=function(){function t(){this.factory=new dragonBones.EgretFactory}return t.prototype.init=function(){this.factory.parseDragonBonesData(RES.getRes("dragon_skin")),this.factory.parseTextureAtlasData(RES.getRes("dragon_texture"),RES.getRes("dragon_png")),this.factory.parseDragonBonesData(RES.getRes("demon_skin")),this.factory.parseTextureAtlasData(RES.getRes("demon_texture"),RES.getRes("demon_png"))},t.prototype.buildArmatureDisplay=function(t){return this.factory.buildArmatureDisplay(t)},t}();t.DBFactory=i,__reflect(i.prototype,"res.DBFactory");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.factory=new egret.MovieClipDataFactory(RES.getRes("badman"),RES.getRes("badmanJson"))},e.prototype.generateMovieClipData=function(t){return this.factory.generateMovieClipData(t)},e}(egret.MovieClipDataFactory);t.McFactory=r,__reflect(r.prototype,"res.McFactory"),t.dbFactory=new t.DBFactory,t.mcFactory=new t.McFactory}(res||(res={}));var Utils=function(){function t(){}return t.getAngle=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=Math.atan2(i,n),o=r/Math.PI*180;return o},t.getRadian=function(e,n){var i=t.getAngle(e,n);return i=i*Math.PI/180},t}();__reflect(Utils.prototype,"Utils");var Main=function(t){function e(){var e=t.call(this)||this;return e.gs=new protocol.GameSocket,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.loadResource,e),e}return __extends(e,t),e.prototype.loadResource=function(t){this.res=new res.assets,this.res.addEventListener(res.Event.ON_COMPLETE,this.createGameScenece,this)},e.prototype.createGameScenece=function(){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.init()["catch"](function(t){console.log(t)})},e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(i){return this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.backgroundM=new view.BackgroundManager,this.infoM=new view.InfoManager,this.monsterGroupM=new view.MonsterGroupManager,this.shipM=new view.ShipManager,this.bulletM=new view.BulletManager,t.prototype.addChild.call(this,this.backgroundM),t.prototype.addChild.call(this,this.infoM),t.prototype.addChild.call(this,this.monsterGroupM),t.prototype.addChild.call(this,this.shipM),t.prototype.addChild.call(this,this.bulletM),e=new egret.URLRequest("http://httpbin.org/user-agent"),n=new egret.URLLoader,n.addEventListener(egret.Event.COMPLETE,function(t){console.log(t.target.data)},this),n.load(e),this.gs.connect("echo.websocket.org",80),this.setListener(),[2]})})},e.prototype.setListener=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){this.bulletM.onTouch(t),this.monsterGroupM.onTouch(t),this.shipM.onTouch(t)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var view;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.bulletSpeed=20,t}return __extends(i,e),i.prototype.onTouch=function(e){var i=new n;this.addChild(i);var r=Utils.getAngle({x:e.localX,y:e.localY},t.ShipManager.instance)+180;i.rotation=r+90,i.moveX=this.bulletSpeed*Math.cos(r*Math.PI/180),i.moveY=this.bulletSpeed*Math.sin(r*Math.PI/180),i.x=t.ShipManager.instance.x+i.moveX,i.y=t.ShipManager.instance.y+i.moveY},i}(base.ViewManager);t.BulletManager=e,__reflect(e.prototype,"view.BulletManager");var n=function(e){function n(){var t=e.call(this)||this;return t._moveX=0,t._moveY=0,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.init,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.removeListener,t),t}return __extends(n,e),n.prototype.checkCollision=function(){for(var e=t.MonsterGroupManager.instance.greenMosters,n=e.length,i=0;n>i;i++){var r=e[i];if(r.hitTestPoint(this.x,this.y,!1)){this.parent.removeChild(this),r.parent.removeChild(r),e.splice(i,1);break}}},n.prototype.init=function(){this.model=new egret.Bitmap(RES.getRes("bullet")),this.addChild(this.model),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.setListener()},n.prototype.removeListener=function(t){this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.init,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeListener,this)},n.prototype.setListener=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},n.prototype.onEnterFrame=function(t){this.x+=this.moveX,this.y+=this.moveY,this.x>this.stage.stageWidth||this.x<0||this.y>this.stage.stageHeight||this.y<0?this.parent.removeChild(this):this.checkCollision()},Object.defineProperty(n.prototype,"moveX",{get:function(){return this._moveX},set:function(t){this._moveX=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"moveY",{get:function(){return this._moveY},set:function(t){this._moveY=t},enumerable:!0,configurable:!0}),n}(egret.Sprite);t.Bullet=n,__reflect(n.prototype,"view.Bullet")}(view||(view={}));var view;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.title=new egret.TextField,this.title.touchEnabled=!0,this.title.text="Egret DEMO",this.title.size=32,this.addChild(this.title),this.setListener(),this.reSize()},e.prototype.setListener=function(){this.title.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTitleTouch,this)},e.prototype.reSize=function(){this.title.x=(this.stage.width-this.title.width)/2},e.prototype.onTitleTouch=function(t){this.title.textColor=1193079},e}(base.ViewManager);t.InfoManager=e,__reflect(e.prototype,"view.InfoManager")}(view||(view={}));var view;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.greenMosters=[],n.instance=t,t}return __extends(n,e),n.prototype.onTouch=function(t){this.demon.tx=t.localX,this.demon.ty=t.localY,this.dragon.tx=t.localX,this.dragon.ty=t.localY},n.prototype.init=function(){this.dragon=new t.Dragon,this.demon=new t.Demon,this.dragon.scaleX=.2,this.dragon.scaleY=this.dragon.scaleX,this.demon.scaleX=.3,this.demon.scaleY=this.demon.scaleX,this.addChild(this.dragon),this.addChild(this.demon),this.dragon.play(t.Dragon.ACTION_WALK),this.demon.play(t.Demon.ACTION_RUN),this.setListener(),this.reSize()},n.prototype.setListener=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},n.prototype.reSize=function(){this.dragon.x=540,this.dragon.y=470,this.demon.x=50,this.demon.y=150},n.prototype.onEnterFrame=function(e){var n=Math.floor(1e3*Math.random())%20;if(0===n){var i=new t.GreenMonster;this.addChild(i),i.gotoAndPlay("run",-1),this.greenMosters.push(i),i.scaleX=.1,i.scaleY=i.scaleX,i.x=Math.random()*this.stage.stageWidth,i.y=Math.random()*this.stage.stageHeight}},n.prototype.getInstance=function(){return n.instance},n}(base.ViewManager);t.MonsterGroupManager=e,__reflect(e.prototype,"view.MonsterGroupManager")}(view||(view={}));var view;!function(t){var e=function(t){function e(){var n=t.call(this)||this;return n._tx=0,n._ty=0,e.instance=n,n}return __extends(e,t),e.prototype.onTouch=function(t){this._tx=t.localX,this._ty=t.localY},e.prototype.init=function(){this.model=new egret.Bitmap(RES.getRes("Ship")),this.model.width=100,this.model.height=100,this.addChild(this.model),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.reSize(),this.setListener()},e.prototype.setListener=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.reSize=function(){this.x=this.stage.stageWidth/2,this.y=this.stage.stageHeight/2},e.prototype.onEnterFrame=function(t){var e=Utils.getAngle({x:this._tx,y:this._ty},this);this.rotation=e-90},e.prototype.getInstance=function(){return e.instance},e}(base.ViewManager);t.ShipManager=e,__reflect(e.prototype,"view.ShipManager")}(view||(view={}));var view;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._tx=0,e._ty=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){this.model=res.dbFactory.buildArmatureDisplay("armatureName"),this.addChild(this.model),this.head=this.model.armature.getBone("head"),this.setListener()},e.prototype.setListener=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.onEnterFrame=function(t){var e=Utils.getRadian({x:this._tx,y:this._ty},this.model);this.head.offset.rotation=e-.8},e.prototype.play=function(t){this.model.animation.play(t)},Object.defineProperty(e.prototype,"tx",{set:function(t){this._tx=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ty",{set:function(t){this._ty=t},enumerable:!0,configurable:!0}),e.ACTION_DEAD="dead",e.ACTION_FREEZE="freeze",e.ACTION_HIT="hit",e.ACTION_NORMAL_ATTACK="normalAttack",e.ACTION_RUN="run",e.ACTION_SKILLATTACK="skillAttack1",e.ACTION_STEADY="steady",e.ACTION_STUN="stun",e.ACTION_UNIQUE_ATTACK="uniqueAttack",e.ACTION_WIN="win",e}(egret.Sprite);t.Demon=e,__reflect(e.prototype,"view.Demon")}(view||(view={}));var view;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._tx=0,e._ty=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.play=function(t){this.model.animation.play(t)},e.prototype.init=function(){this.model=res.dbFactory.buildArmatureDisplay("Dragon"),this.addChild(this.model),this.head=this.model.armature.getBone("head"),this.setListener()},e.prototype.setListener=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.onEnterFrame=function(t){var e=Utils.getAngle({x:this._tx,y:this._ty},this);this.head.offset.rotation=e/180*Math.PI},Object.defineProperty(e.prototype,"tx",{set:function(t){this._tx=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ty",{set:function(t){this._ty=t},enumerable:!0,configurable:!0}),e.ACTION_FALL="fall",e.ACTION_JUMP="jump",e.ACTION_STAND="stand",e.ACTION_WALK="walk",e}(egret.Sprite);t.Dragon=e,__reflect(e.prototype,"view.Dragon")}(view||(view={}));var view;!function(t){var e=function(t){function e(){var e=t.call(this,res.mcFactory.generateMovieClipData("mo"))||this;return e._tx=0,e._ty=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeListener,e),e}return __extends(e,t),e.prototype.init=function(){this._tx=Math.random()*this.stage.stageWidth*2-this.stage.stageWidth,this._ty=Math.random()*this.stage.stageHeight*2-this.stage.stageHeight,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.gotoAndPlay("run",-1),this.setListener()},e.prototype.setListener=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.removeListener=function(t){this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.init,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeListener,this)},e.prototype.onEnterFrame=function(t){this.x+=(this._tx-this.x)/500,this.y+=(this._ty-this.y)/500},Object.defineProperty(e.prototype,"tx",{set:function(t){this._tx=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ty",{set:function(t){this._ty=t},enumerable:!0,configurable:!0}),e}(egret.MovieClip);t.GreenMonster=e,__reflect(e.prototype,"view.GreenMonster")}(view||(view={}));